services:
  flutter-dev:
    build:
      context: .
      # Removido: args com USER_ID e USER_GID
    container_name: flutter-dev-container
    stdin_open: true
    tty: true
    volumes:
      # ⚠️ CHANGE THIS PATH: Point to your Flutter project directory
      # Example: - /home/YOUR_USERNAME/your-project:/workspace:cached
      - /home/mamaral-/Documents/42Advanced/Github/42Porto-MobilePiscine/mobileModule00:/workspace:cached
      - /home/mamaral-/goinfre/volumes/flutter-sdk:/home/developer/flutter:cached
      - /home/mamaral-/goinfre/volumes/android-sdk:/home/developer/android-sdk:cached
      - pub-cache:/home/developer/pub-cache
      - gradle-cache:/home/developer/gradle-cache
      - /home/mamaral-/goinfre/volumes/android-config:/home/developer/.android:cached
      # Writable copy of Flutter SDK (named volume) used at runtime when host mount is not writable
      - flutter-exec:/home/developer/flutter-exec
      # X11 socket for GUI apps (Flutter Linux desktop)
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /run/user/101034:/run/user/101034:rw
    environment:
      - FLUTTER_HOME=/home/developer/flutter
      - ANDROID_HOME=/home/developer/android-sdk
      - ANDROID_SDK_ROOT=/home/developer/android-sdk
      - PUB_CACHE=/home/developer/pub-cache
      - GRADLE_USER_HOME=/home/developer/gradle-cache
      - JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
      - DISPLAY=${DISPLAY}
      - XDG_RUNTIME_DIR=/run/user/101034
      - LIBGL_ALWAYS_SOFTWARE=1
    working_dir: /workspace
    ports:
      - "8080:8080"
      - "5000-5100:5000-5100"

volumes:
  pub-cache:
    driver: local
  gradle-cache:
    driver: local
  flutter-exec:
    driver: local
